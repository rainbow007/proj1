"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_ansiEscapes=require("ansi-escapes"),_ansiEscapes2=_interopRequireDefault(_ansiEscapes),_socket=require("socket.io-client"),_socket2=_interopRequireDefault(_socket),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_events=require("events"),_events2=_interopRequireDefault(_events),Logger=function(e){function t(e){var o=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],r=o.debug,s=void 0!==r&&r,i=o.quiet,n=void 0!==i&&i;(0,_classCallCheck3.default)(this,t);var l=(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(t).call(this));return l.host=e,l.debug=s,l.quiet=n,l.building=!1,l.socket=(0,_socket2.default)("https://io.now.sh?host="+e),l.socket.once("error",l.onSocketError.bind(l)),l.socket.on("state",l.onState.bind(l)),l.socket.on("logs",l.onLog.bind(l)),l.socket.on("backend",l.onComplete.bind(l)),l.lines=new Lines(10),l}return(0,_inherits3.default)(t,e),(0,_createClass3.default)(t,[{key:"onState",value:function(e){return e.id?e.error?(console.error("> Deployment error"),void this.emit("error")):e.backend?void this.onComplete():void(e.logs&&e.logs.forEach(this.onLog,this)):(console.error("> Deployment not found"),void this.emit("error"))}},{key:"onLog",value:function(e){var t=this;this.building||(this.quiet||console.log("> Building"),this.building=!0),this.quiet||("command"===e.type?(console.log(_chalk2.default.gray(">")+" â–² "+e.data),this.lines.reset()):"stderr"===e.type?(e.data.split("\n").forEach(function(e){e.length&&console.error(_chalk2.default.red("> "+e))}),this.lines.reset()):"stdout"===e.type&&e.data.split("\n").forEach(function(e){e.length&&t.lines.write(_chalk2.default.gray(">")+" "+e)}))}},{key:"onComplete",value:function(){this.socket.disconnect(),this.building&&(this.building=!1),this.emit("close")}},{key:"onSocketError",value:function(e){this.debug&&console.log("> [debug] Socket error",e.stack)}}]),t}(_events2.default);exports.default=Logger;var Lines=function(){function e(){var t=arguments.length<=0||void 0===arguments[0]?100:arguments[0];(0,_classCallCheck3.default)(this,e),this.max=t,this.buf=[]}return(0,_createClass3.default)(e,[{key:"write",value:function(e){var t=this.max,o=this.buf;o.length===t&&(process.stdout.write(_ansiEscapes2.default.eraseLines(t+1)),o.shift(),o.forEach(function(e){return console.log(e)})),o.push(e),console.log(e)}},{key:"reset",value:function(){this.buf=[]}}]),e}();