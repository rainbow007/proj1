"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(exports,"__esModule",{value:!0});var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),_lib=require("../lib"),_lib2=_interopRequireDefault(_lib),Secrets=function(e){function r(){return(0,_classCallCheck3.default)(this,r),(0,_possibleConstructorReturn3.default)(this,(0,_getPrototypeOf2.default)(r).apply(this,arguments))}return(0,_inherits3.default)(r,e),(0,_createClass3.default)(r,[{key:"ls",value:function(){var e=this;return this.retry(function(){var r=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function r(t,n){var s,u;return _regenerator2.default.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e._debug&&console.time("> [debug] #"+n+" GET /secrets"),r.next=3,e._fetch("/secrets");case 3:return s=r.sent,e._debug&&console.timeEnd("> [debug] #"+n+" GET /secrets"),r.next=7,s.json();case 7:return u=r.sent,r.abrupt("return",u.secrets);case 9:case"end":return r.stop()}},r,e)}));return function(e,t){return r.apply(this,arguments)}}())}},{key:"rm",value:function(e){var r=this;return this.retry(function(){var t=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function t(n,s){var u,a,o;return _regenerator2.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r._debug&&console.time("> [debug] #"+s+" DELETE /secrets/"+e),t.next=3,r._fetch("/secrets/"+e,{method:"DELETE"});case 3:if(u=t.sent,r._debug&&console.timeEnd("> [debug] #"+s+" DELETE /secrets/"+e),403!==u.status){t.next=7;break}return t.abrupt("return",n(new Error("Unauthorized")));case 7:return t.next=9,u.json();case 9:if(a=t.sent,200===u.status){t.next=18;break}if(404!==u.status&&400!==u.status){t.next=17;break}return o=new Error(a.error.message),o.userError=!0,t.abrupt("return",n(o));case 17:throw new Error(a.error.message);case 18:return t.abrupt("return",a);case 19:case"end":return t.stop()}},t,r)}));return function(e,r){return t.apply(this,arguments)}}())}},{key:"add",value:function(e,r){var t=this;return this.retry(function(){var n=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function n(s,u){var a,o,i;return _regenerator2.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t._debug&&console.time("> [debug] #"+u+" POST /secrets"),n.next=3,t._fetch("/secrets",{method:"POST",body:{name:e,value:r}});case 3:if(a=n.sent,t._debug&&console.timeEnd("> [debug] #"+u+" POST /secrets"),403!==a.status){n.next=7;break}return n.abrupt("return",s(new Error("Unauthorized")));case 7:return n.next=9,a.json();case 9:if(o=n.sent,200===a.status){n.next=18;break}if(404!==a.status&&400!==a.status){n.next=17;break}return i=new Error(o.error.message),i.userError=!0,n.abrupt("return",s(i));case 17:throw new Error(o.error.message);case 18:return n.abrupt("return",o);case 19:case"end":return n.stop()}},n,t)}));return function(e,r){return n.apply(this,arguments)}}())}},{key:"rename",value:function(e,r){var t=this;return this.retry(function(){var n=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function n(s,u){var a,o,i;return _regenerator2.default.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return t._debug&&console.time("> [debug] #"+u+" PATCH /secrets/"+e),n.next=3,t._fetch("/secrets",{method:"PATCH",body:(0,_stringify2.default)({name:r})});case 3:if(a=n.sent,t._debug&&console.timeEnd("> [debug] #"+u+" PATCH /secrets/"+e),403!==a.status){n.next=7;break}return n.abrupt("return",s(new Error("Unauthorized")));case 7:return n.next=9,a.json();case 9:if(o=n.sent,200===a.status){n.next=18;break}if(404!==a.status&&400!==a.status){n.next=17;break}return i=new Error(o.error.message),i.userError=!0,n.abrupt("return",s(i));case 17:throw new Error(o.error.message);case 18:return n.abrupt("return",o);case 19:case"end":return n.stop()}},n,t)}));return function(e,r){return n.apply(this,arguments)}}())}}]),r}(_lib2.default);exports.default=Secrets;