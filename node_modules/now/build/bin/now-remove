#!/usr/bin/env node
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function readConfirmation(e,r){return new _promise2.default(function(t,n){var a=_chalk2.default.gray((0,_ms2.default)(new Date-e.created)+" ago"),o=(0,_textTable2.default)([[e.uid,_chalk2.default.underline("https://"+e.url),a]],{align:["l","r","l"],hsep:" ".repeat(6)});process.stdout.write("> The following deployment will be removed permanently\n"),process.stdout.write("  "+o+"\n"),r.length&&process.stdout.write("> "+_chalk2.default.yellow("Warning!")+" This deployment's "+(_chalk2.default.bold(r.length+" alias"+(r.length>1?"es":""))+" ")+("will be removed. Run "+_chalk2.default.dim("`now alias ls`")+" to list.\n")),process.stdout.write(_chalk2.default.bold.red("> Are you sure?")+" "+_chalk2.default.gray("[yN] ")),process.stdin.on("data",function(e){process.stdin.pause(),t(e.toString().trim())}).resume()})}var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),remove=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){var t,n,a,o,l,i,u;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _lib2.default(apiUrl,r,{debug:debug}),e.next=3,t.list();case 3:if(n=e.sent,a=n.find(function(e){return e.uid===deploymentId}),null==deploymentId||a){e.next=8;break}return(0,_error.error)("Could not find a deployment by "+_chalk2.default.bold('"'+deploymentId+'"')+". Run "+_chalk2.default.dim("`now ls`")+" to list."),e.abrupt("return",process.exit(1));case 8:return e.next=10,t.listAliases(a.uid);case 10:return o=e.sent,e.prev=11,e.next=14,readConfirmation(a,o);case 14:return l=e.sent.toLowerCase(),"y"!==l&&"yes"!==l&&(console.log("\n> Aborted"),process.exit(0)),i=new Date,e.next=19,t.remove(deploymentId,{hard:hard});case 19:u=(0,_ms2.default)(new Date-i),console.log(_chalk2.default.cyan("> Success!")+" Deployment "+_chalk2.default.bold(deploymentId)+" removed ["+u+"]"),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(11),(0,_error.handleError)(e.t0),process.exit(1);case 27:t.close();case 28:case"end":return e.stop()}},e,this,[[11,23]])}));return function(r){return e.apply(this,arguments)}}(),_minimist=require("minimist"),_minimist2=_interopRequireDefault(_minimist),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_ms=require("ms"),_ms2=_interopRequireDefault(_ms),_textTable=require("text-table"),_textTable2=_interopRequireDefault(_textTable),_lib=require("../lib"),_lib2=_interopRequireDefault(_lib),_login=require("../lib/login"),_login2=_interopRequireDefault(_login),_cfg=require("../lib/cfg"),cfg=_interopRequireWildcard(_cfg),_error=require("../lib/error"),argv=(0,_minimist2.default)(process.argv.slice(2),{boolean:["help","debug","hard"],alias:{help:"h",debug:"d"}}),deploymentId=argv._[0],help=function(){console.log("\n  "+_chalk2.default.bold("ùö´ now remove")+" [deploymentId]\n\n  "+_chalk2.default.dim("Options:")+"\n\n    -h, --help   output usage information\n    -d, --debug  debug mode [off]\n\n  "+_chalk2.default.dim("Examples:")+"\n\n  "+_chalk2.default.gray("‚Äì")+" Remove a deployment identified by "+_chalk2.default.dim("`deploymentId`")+":\n\n    "+_chalk2.default.cyan("$ now rm deploymentId")+"\n\n  "+_chalk2.default.dim("Alias:")+" rm\n")};!argv.help&&deploymentId||(help(),process.exit(0));var debug=argv.debug,apiUrl=argv.url||"https://api.zeit.co",hard=argv.hard||!1,config=cfg.read();_promise2.default.resolve(config.token||(0,_login2.default)(apiUrl)).then(function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,remove(r);case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),(0,_error.error)("Unknown error: "+e.t0.stack),process.exit(1);case 9:case"end":return e.stop()}},e,void 0,[[0,5]])}));return function(r){return e.apply(this,arguments)}}()).catch(function(e){(0,_error.error)("Authentication error ‚Äì "+e.message),process.exit(1)});