#!/usr/bin/env node
"use strict";function _interopRequireWildcard(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function indent(e,r){return e.split("\n").map(function(e){return" ".repeat(r)+e}).join("\n")}var _getIterator2=require("babel-runtime/core-js/get-iterator"),_getIterator3=_interopRequireDefault(_getIterator2),_slicedToArray2=require("babel-runtime/helpers/slicedToArray"),_slicedToArray3=_interopRequireDefault(_slicedToArray2),_toConsumableArray2=require("babel-runtime/helpers/toConsumableArray"),_toConsumableArray3=_interopRequireDefault(_toConsumableArray2),_map=require("babel-runtime/core-js/map"),_map2=_interopRequireDefault(_map),_regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),list=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){var t,a,n,i,o,u,l,s,c,p,_,f,d;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=new _lib2.default(apiUrl,r,{debug:debug}),a=void 0,e.prev=2,e.next=5,t.list(app);case 5:a=e.sent,e.next=12;break;case 8:e.prev=8,e.t0=e.catch(2),(0,_error.handleError)(e.t0),process.exit(1);case 12:for(t.close(),n=new _map2.default,i=!0,o=!1,u=void 0,e.prev=17,l=(0,_getIterator3.default)(a);!(i=(s=l.next()).done);i=!0)c=s.value,p=n.get(c.name)||[],n.set(c.name,p.concat(c));e.next=25;break;case 21:e.prev=21,e.t1=e.catch(17),o=!0,u=e.t1;case 25:e.prev=25,e.prev=26,!i&&l.return&&l.return();case 28:if(e.prev=28,!o){e.next=31;break}throw u;case 31:return e.finish(28);case 32:return e.finish(25);case 33:return e.next=35,sort([].concat((0,_toConsumableArray3.default)(n)));case 35:_=e.sent,f=Date.now(),d=_.map(function(e){var r=(0,_slicedToArray3.default)(e,2),t=r[0],a=r[1],n=(0,_textTable2.default)(a.map(function(e){var r=e.uid,t=e.url,a=e.created,n=_chalk2.default.underline("https://"+t),i=_chalk2.default.gray((0,_ms2.default)(f-a)+" ago");return[r,n,i]}),{align:["l","r","l"],hsep:" ".repeat(6)});return _chalk2.default.bold(t)+"\n\n"+indent(n,2)}).join("\n\n"),d&&console.log("\n"+d+"\n");case 39:case"end":return e.stop()}},e,this,[[2,8],[17,21,25,33],[26,,28,32]])}));return function(r){return e.apply(this,arguments)}}(),sort=function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){var t,a;return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=void 0,e.prev=1,e.next=4,_fsPromise2.default.readFile("package.json");case 4:a=e.sent,t=JSON.parse(a),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),t={};case 11:return e.abrupt("return",r.map(function(e){var r=(0,_slicedToArray3.default)(e,2),t=r[0],a=r[1];return a=a.slice().sort(function(e,r){return r.created-e.created}),[t,a]}).sort(function(e,r){var a=(0,_slicedToArray3.default)(e,2),n=a[0],i=a[1],o=(0,_slicedToArray3.default)(r,2),u=o[0],l=o[1];return t.name===n?-1:t.name===u?1:l[0].created-i[0].created}));case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(r){return e.apply(this,arguments)}}(),_fsPromise=require("fs-promise"),_fsPromise2=_interopRequireDefault(_fsPromise),_minimist=require("minimist"),_minimist2=_interopRequireDefault(_minimist),_chalk=require("chalk"),_chalk2=_interopRequireDefault(_chalk),_textTable=require("text-table"),_textTable2=_interopRequireDefault(_textTable),_ms=require("ms"),_ms2=_interopRequireDefault(_ms),_lib=require("../lib"),_lib2=_interopRequireDefault(_lib),_login=require("../lib/login"),_login2=_interopRequireDefault(_login),_cfg=require("../lib/cfg"),cfg=_interopRequireWildcard(_cfg),_error=require("../lib/error"),argv=(0,_minimist2.default)(process.argv.slice(2),{boolean:["help","debug"],alias:{help:"h",debug:"d"}}),help=function(){console.log("\n  "+_chalk2.default.bold("ùö´ now list")+" [app]\n\n  "+_chalk2.default.dim("Options:")+"\n\n    -h, --help   output usage information\n    -d, --debug  debug mode [off]\n\n  "+_chalk2.default.dim("Examples:")+"\n\n  "+_chalk2.default.gray("‚Äì")+" List all deployments\n\n    "+_chalk2.default.cyan("$ now ls")+"\n\n  "+_chalk2.default.gray("‚Äì")+" List all deployments for the app "+_chalk2.default.dim("`my-app`")+"\n\n    "+_chalk2.default.cyan("$ now ls my-app")+"\n\n  "+_chalk2.default.dim("Alias:")+" ls\n")};argv.help&&(help(),process.exit(0));var app=argv._[0],debug=argv.debug,apiUrl=argv.url||"https://api.zeit.co",config=cfg.read();_promise2.default.resolve(config.token||(0,_login2.default)(apiUrl)).then(function(){var e=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function e(r){return _regenerator2.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,list(r);case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),(0,_error.error)("Unknown error: "+e.t0.stack),process.exit(1);case 9:case"end":return e.stop()}},e,void 0,[[0,5]])}));return function(r){return e.apply(this,arguments)}}()).catch(function(e){(0,_error.error)("Authentication error ‚Äì "+e.message),process.exit(1)});